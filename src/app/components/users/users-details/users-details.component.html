<section class="flex flex-col items-center mt-6 px-4 w-full max-w-2xl mx-auto">
  <!-- Contenedor principal -->
  <div class="bg-white shadow-lg rounded-lg p-6 w-full">
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-800">
      {{ user?.name }} {{ user?.paternalSurname }} {{ user?.maternalSurname }}
    </h1>

    <!-- Información del usuario -->
    <div class="divide-y divide-gray-300 space-y-6">

      <!-- Información personal -->
      <div class="space-y-4">
        <h2 class="text-xl font-medium text-gray-700">Información Personal</h2>
        <div class="space-y-4">
          <!-- ID -->
          <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
            <i class="ti ti-id text-2xl text-gray-500 mr-3"></i>
            <span class="font-medium text-gray-700">ID:</span>
            <span class="ml-auto text-gray-600">{{ user?.id }}</span>
          </div>

          <!-- Nombre -->
          <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
            <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
            <span class="font-medium text-gray-700">Nombre:</span>
            <span class="ml-auto text-gray-600">{{ user?.name }}</span>
          </div>

          <!-- Apellidos -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
              <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
              <span class="font-medium text-gray-700">Apellido Paterno:</span>
              <span class="ml-auto text-gray-600">{{ user?.paternalSurname }}</span>
            </div>
            <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
              <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
              <span class="font-medium text-gray-700">Apellido Materno:</span>
              <span class="ml-auto text-gray-600">{{ user?.maternalSurname }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Información de contacto -->
      <div class="space-y-4">
        <h2 class="text-xl font-medium text-gray-700">Información de Contacto</h2>
        <div class="space-y-4">
          <!-- Correo Electrónico -->
          <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
            <i class="ti ti-mail text-2xl text-gray-500 mr-3"></i>
            <span class="font-medium text-gray-700">Correo Electrónico:</span>
            <span class="ml-auto text-green-500">{{ user?.email }}</span>
          </div>

          <!-- Teléfonos -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
              <i class="ti ti-phone text-2xl text-gray-500 mr-3"></i>
              <span class="font-medium text-gray-700">Teléfono:</span>
              <span class="ml-auto text-gray-600">{{ user?.phone }}</span>
            </div>
            <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
              <i class="ti ti-phone-plus text-2xl text-gray-500 mr-3"></i>
              <span class="font-medium text-gray-700">Teléfono Respaldo:</span>
              <span class="ml-auto text-gray-600">{{ user?.phoneBackup }}</span>
            </div>
          </div>

          <!-- Dirección -->
          <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
            <i class="ti ti-map-pin text-2xl text-gray-500 mr-3"></i>
            <span class="font-medium text-gray-700">Dirección:</span>
            <span class="ml-auto text-gray-600">{{ user?.address }}</span>
          </div>
        </div>
      </div>

      <!-- Información adicional -->
      <div class="space-y-4">
        <h2 class="text-xl font-medium text-gray-700">Información Adicional</h2>

        <!-- DNI -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-id text-2xl text-gray-500 mr-3"></i>
          <span class="font-medium text-gray-700">DNI:</span>
          <span class="ml-auto text-gray-600">{{ user?.dni }}</span>
        </div>

        <!-- Rol -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-users text-2xl text-gray-500 mr-3"></i>
          <span class="font-medium text-gray-700">Rol:</span>
          <span class="ml-auto text-gray-600">{{ user?.role }}</span>
        </div>

        <!-- Fecha de Nacimiento -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-calendar text-2xl text-gray-500 mr-3"></i>
          <span class="font-medium text-gray-700">Fecha de Nacimiento:</span>
          <span class="ml-auto text-gray-600">{{ user?.birthdate | date:'dd/MM/yyyy' }}</span>
      </div>
     </div>
    </div>

    <div class="flex justify-center gap-8 mt-8">
      <!-- Botón "Volver a la Lista" -->
      <a
        class="bg-blue-100 text-blue-700 px-6 py-3 rounded-full text-base font-medium hover:bg-blue-200 transition duration-200"
        routerLink="/users"
      >
        Volver a la Lista
      </a>

      <!-- Botón "Editar Información" (solo para admins) -->
      <button
        *ngIf="isAdmin()"
        class="bg-blue-100 text-blue-700 px-6 py-3 rounded-full text-base font-medium hover:bg-blue-200 transition duration-200"
        (click)="openEditModal()"
      >
        Editar Información
      </button>
    </div>
  </div>
</section>

<!-- Modal de Edición -->
<div *ngIf="showEditModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <!-- Contenedor de la modal con scroll limitado -->
  <div class="bg-white w-full max-w-2xl rounded-lg p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
    <h2 class="text-2xl font-bold text-center text-blue-800 mb-6">Editar Información</h2>
    <form (ngSubmit)="saveUserDetails()" #userForm="ngForm" novalidate>
      <div class="space-y-4">

        <!-- Campo: Nombre de usuario -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-user text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Nombre de usuario</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.username"
              name="username"
              required
              maxlength="20"
            />
            <div *ngIf="userForm.submitted && userForm.controls['username']?.invalid" class="text-red-500 text-sm">
              Usuario es obligatorio y debe tener máximo 20 caracteres.
            </div>
          </div>
        </div>

        <!-- Campo: Contraseña -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-lock text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Nueva Contraseña (opcional)</label>
            <input
              type="password"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.password"
              name="password"
              minlength="6"
            />
            <div
              *ngIf="userForm.submitted && userForm.controls['password']?.errors?.['minlength']"
              class="text-red-500 text-sm"
            >
              La contraseña debe tener al menos 6 caracteres.
            </div>
            <p class="text-sm text-gray-600">Este campo es opcional.</p>
          </div>
         </div>


        <!-- Campo: Nombre -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Nombre</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.name"
              name="name"
              required
              maxlength="100"
            />
          </div>
        </div>

        <!-- Campo: Apellido Paterno -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Apellido Paterno</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.paternalSurname"
              name="paternalSurname"
              maxlength="100"
            />
          </div>
        </div>

        <!-- Campo: Apellido Materno -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-id-badge text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Apellido Materno</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.maternalSurname"
              name="maternalSurname"
              maxlength="100"
            />
          </div>
        </div>

        <!-- Campo: DNI -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-id text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">DNI</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.dni"
              name="dni"
              required
              pattern="^\d{8}$"
            />
            <div *ngIf="userForm.submitted && userForm.controls['dni']?.invalid" class="text-red-500 text-sm">
              DNI debe tener exactamente 8 dígitos numéricos.
            </div>
          </div>
        </div>

        <!-- Campo: Fecha de Nacimiento -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-calendar text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Fecha de Nacimiento</label>
            <input
              type="date"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.birthdate"
              name="birthdate"
              [max]="maxBirthdate"
            />
            <div *ngIf="userForm.submitted && userForm.controls['birthdate']?.errors?.['max']" class="text-red-500 text-sm">
              La fecha de nacimiento no debe ser posterior a hoy.
            </div>
          </div>
        </div>

        <!-- Campo: Correo Electrónico -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-mail text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Correo Electrónico</label>
            <input
              type="email"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.email"
              name="email"
              required
              maxlength="100"
            />
          </div>
        </div>

        <!-- Campo: Teléfono Principal -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-phone text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Teléfono</label>
            <input
              type="tel"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.phone"
              name="phone"
              required
              pattern="^\d{9}$"
            />
          </div>
        </div>

        <!-- Campo: Dirección -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <i class="ti ti-map-pin text-2xl text-gray-500 mr-3"></i>
          <div class="w-full">
            <label class="block text-gray-700 font-medium mb-1">Dirección</label>
            <input
              type="text"
              class="w-full border px-4 py-2 rounded-lg"
              [(ngModel)]="editableUser.address"
              name="address"
              maxlength="200"
            />
          </div>
        </div>

        <!-- Checkbox: Habilitado -->
        <div class="flex items-center border border-gray-300 rounded-lg shadow-sm p-3">
          <input
            type="checkbox"
            class="mr-3"
            [(ngModel)]="editableUser.enabled"
            name="enabled"
          />
          <span class="text-gray-700">Usuario habilitado</span>
        </div>

      </div>

      <!-- Botones -->
      <div class="flex justify-end mt-6">
        <button
          type="button"
          class="bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition-all"
          (click)="closeEditModal()"
        >
          Cancelar
        </button>
        <button
          type="submit"
          class="ml-4 bg-blue-600 text-white py-2 px-6 rounded-md hover:bg-blue-700 transition-all"
          [disabled]="isLoading || !userForm.valid"
        >
          Guardar Cambios
        </button>
      </div>
    </form>
  </div>
</div>
